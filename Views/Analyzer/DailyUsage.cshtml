<div class="container">
    <div class="chart-container">
        <h1 class="yell">Your weekly Activity</h1>
        <canvas id="weeklyUsage" class="small-chart" width="400" height="200"></canvas>

        <div class="circle-container">
            <div class="circle">
                <div class="circle-content">
                    <div id="loader">
                        <div>
                            <div id="box"></div>
                            <div id="hill"></div>
                        </div>
                        <div class="timeContainer">
                            <p id="time">1h 35m</p>
                        </div>

                    </div>
                    <p class="text">Today's Activity</p>
                </div>
            </div>
        </div>
    </div>
</div>






<style>
    * {
        font-family: 'Times New Roman';
    }

    .small-chart {
        max-height: 350px;
        max-width: 700px;
        border-radius: 10px;
        background-color: #f0f0f0;
        box-shadow: 1px 1px 0 1px #f9f9fb, -1px 0 28px 0 rgba(34, 33, 81, 0.01), 28px 28px 28px 0 rgba(34, 33, 81, 0.25);
    }

    .chart-container {
        display: flex;
        flex-direction: column;
        align-items: center;
    }



    .circle-container {
        position: relative;
        margin-top: 50px;
        margin-left: 20px; /* Adjust the margin as needed */

    }

    .circle {
        width: 300px;
        height: 300px;
        border-radius: 50%;
        background-color: #f0f0f0;
        display: flex;
        justify-content: center;
        align-items: center;
        transition: transform 2s ease-in-out;
        transform: scale(1);
        border: 1px solid #36a2eb;
    }

        .circle:hover {
            transform: scale(1.1);
        }

    .circle-content {
        display: flex;
        flex-direction: column;
        text-align: center;
    }

    #time {
        font-size: 30px;
        margin: 0;
        margin-left: 3em;
        color: #36a2eb;
    }

    .text {
        margin-top: 4em;
        font-size: 28px;
        font-weight: 800;
        text-align: center;
    }


    .timeContainer {
        width: 50px;
    }




    #loader {
        position: absolute;
        top: 50%;
        left: 50%;
        margin-top: -4.7em;
        margin-left: -5.7em;
        width: 5.4em;
        height: 5.4em;
        background-color: #f0f0f0;
        display: flex;

    }

    #hill {
        position: absolute;
        width: 7.1em;
        height: 7.1em;
        top: 1.7em;
        left: 1.7em;
        background-color: transparent;
        border-left: .25em solid #404456;
        transform: rotate(45deg);
    }



    #box {
        position: absolute;
        left: 0;
        bottom: -.1em;
        width: 1em;
        height: 1em;
        background-color: transparent;
        border: .25em solid #404456;
        border-radius: 15%;
        transform: translate(0, -1em) rotate(-45deg);
        animation: push 2.5s cubic-bezier(.79, 0, .47, .97) infinite;
    }

    @@keyframes push {
        0% {
            transform: translate(0, -1em) rotate(-45deg);
        }

        5% {
            transform: translate(0, -1em) rotate(-50deg);
        }

        20% {
            transform: translate(1em, -2em) rotate(47deg);
        }

        25% {
            transform: translate(1em, -2em) rotate(45deg);
        }

        30% {
            transform: translate(1em, -2em) rotate(40deg);
        }

        45% {
            transform: translate(2em, -3em) rotate(137deg);
        }

        50% {
            transform: translate(2em, -3em) rotate(135deg);
        }

        55% {
            transform: translate(2em, -3em) rotate(130deg);
        }

        70% {
            transform: translate(3em, -4em) rotate(217deg);
        }

        75% {
            transform: translate(3em, -4em) rotate(220deg);
        }

        100% {
            transform: translate(0, -1em) rotate(-225deg);
        }
    }
</style>




@section scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>

    <script>
        $(document).ready(function () { 
            $.ajax({
                type:"GET",
                url: "/Analyzer/GetUsageDataForPastWeek",
                data: "",
                contextType: "application/json; charset=utf8",
                dataType: "json",
                success: OnSuccess,
                error: function (xhr, status, error) {
                    // Handle the error here
                    console.log("AJAX request failed: " + status + ", " + error);
                }
            })
        });

        function OnSuccess(data) { 
            console.log("hello");
            const ctx = document.getElementById('weeklyUsage');
            var _data = data;
            var _labels = _data[0].reverse();
            var _CharData = _data[1].reverse();


            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: _labels,
                    datasets: [{
                        label: 'Daily use',
                        data: _CharData,
                        borderWidth: 3
                    }]
                },
                options: {
                    animations: {
                        radius: {
                            duration: 500,
                            easing: 'easeInCirc',
                            loop: (context) => context.active
                        }
                    },
                    hoverRadius: 12,
                    hoverBackgroundColor: 'red',
                    interaction: {
                        mode: 'nearest',
                        intersect: false,
                        axis: 'x'
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Minutes',
                                font: {
                                    size:'10'
                                }
                            }
                        }
                    }
                }
            });

            dailyUse(_CharData[_CharData.length - 1]);
        }

        function dailyUse(minutes) {
            // Calculate the hours and minutes
            const hours = Math.floor(minutes / 60);
            const remainingMinutes = minutes % 60;

            // Format the result as a string
            const formattedTime = `${hours}h ${remainingMinutes}m`;

            // Get the DOM element where you want to set the value
            const timeDisplayElement = document.getElementById('time');

            // Set the value of the DOM element
          //  timeDisplayElement.classList.add("")
            timeDisplayElement.textContent = formattedTime;
        }

    </script>
}